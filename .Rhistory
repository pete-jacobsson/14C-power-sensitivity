for (model in model_names) {
## This will get a little experimental - we are trying to create a big old table!
## First, we thin down the DF to the model of interest
temp_results <- single_cals_modelled %>%
select(1, 2, all_of(model)) %>% #All of used to address deprecation
rename(glm_list = 3) %>% #This rename allows map to work correctly
mutate(
logistic_results = map(glm_list, tidy), # Do the map and also take note of which model
model = model
) %>%
select(-glm_list) %>% # Gets rid of the actual models (necessary for saving as csv)
unnest(logistic_results)# Unnests results
temp_diagnostics <- single_cals_modelled %>%
select(1, 2, all_of(model)) %>%
rename(glm_list = 3) %>%
mutate(
logistic_diagnostics = map(glm_list, glance),
model = model
) %>%
select(-glm_list) %>%
unnest(logistic_diagnostics)
single_cals_log_results <- rbind(single_cals_log_results, temp_results)
single_cals_log_diagnostics <- rbind(single_cals_log_diagnostics,
temp_diagnostics)
}
write_csv(single_cals_log_results,
"model_results/single_cals_log_results.csv")
write_csv(single_cals_log_diagnostics,
"model_results/single_cals_log_diagnostics.csv")
single_cals_log_diagnostics <- read_csv("model_results/single_cals_log_diagnostics.csv")
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw()
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = BIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw()
single_cals_log_diagnostics %>%
filter(str_detect(model, "95")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw()
single_cals_log_diagnostics %>%
filter(str_detect(model, "95")) %>%
ggplot(aes(x = target_year, y = BIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw()
cal_curve_binned <- read_csv("intcal_20_interpolated.csv") %>%
mutate(binned_targets = ntile(CalBP, 50)) %>%
group_by(binned_targets) %>%
summarize(bp_sd = sd(BP)) # Cal plateaus = way less variation on the BP scale
inner_join(single_cals_log_diagnostics, cal_curve_binned) %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = bp_sd, y = AIC)) +
geom_point(aes(colour = model)) +
facet_wrap(~model)
cal_curve_binned <- read_csv("intcal_20_interpolated.csv") %>%
mutate(binned_targets = ntile(CalBP, 50)) %>%
group_by(binned_targets) %>%
summarize(
bp_sd = sd(BP),
target_year = min(CalBP)) # Cal plateaus = way less variation on the BP scale
inner_join(single_cals_log_diagnostics, cal_curve_binned) %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = bp_sd, y = AIC)) +
geom_point(aes(colour = model)) +
facet_wrap(~model)
cal_curve_binned <- read_csv("intcal_20_interpolated.csv") %>%
mutate(binned_targets = ntile(CalBP, 50)) %>%
group_by(binned_targets) %>%
summarize(
bp_sd = sd(BP),
target_year = min(CalBP))
cal_curve_binned <- read_csv("intcal_20_interpolated.csv") %>%
mutate(binned_targets = ntile(CalBP, 50)) %>%
group_by(binned_targets) %>%
summarize(
bp_sd = sd(BP),
target_year = min(CalBP)) %>%
select(-binned_targets)# Cal plateaus = way less variation on the BP scale
inner_join(single_cals_log_diagnostics, cal_curve_binned)
single_cals_log_results <- read_csv("model_results/single_cals_log_results.csv")
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = bin_start, y = estimate)) +
geom_line(aes(color = term)) +
facet_grid(rows = vars(offset_pos), cols = vars(model))
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_line(aes(color = term)) +
facet_grid(rows = vars(offset_pos), cols = vars(model))
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_line(aes(color = term)) +
facet_grid(rows = vars(offset_pos), cols = vars(model), scales = "free")
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_line(aes(color = term)) +
facet_grid(cols = vars(offset_pos), rows = vars(model), scales = "free")
library(tidyverse)
library(broom)
single_cals_log_diagnostics <- read_csv("model_results/single_cals_log_diagnostics.csv")
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw()
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = BIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw()
single_cals_log_diagnostics %>%
filter(str_detect(model, "95")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw()
single_cals_log_diagnostics %>%
filter(str_detect(model, "95")) %>%
ggplot(aes(x = target_year, y = BIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw()
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_brewer()
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_brewer(palette = "Dark2")
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_brewer(palette = "RdYlBu")
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_brewer(palette = "Paired")
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_brewer(palette = "Accent")
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_brewer(palette = "Pastel2")
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_brewer(palette = "Paired")
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_brewer(palette = "YlGnBu")
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_brewer(palette = "YlGnBu") +
theme(panel.grid.minor = element_blank())
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_brewer(palette = "Spectral") +
theme(panel.grid.minor = element_blank())
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_grey() +
theme(panel.grid.minor = element_blank())
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_grey() +
theme(panel.grid.minor = element_blank())
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = BIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_grey() +
theme(panel.grid.minor = element_blank())
single_cals_log_diagnostics %>%
filter(str_detect(model, "95")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_grey() +
theme(panel.grid.minor = element_blank())
single_cals_log_diagnostics %>%
filter(str_detect(model, "95")) %>%
ggplot(aes(x = target_year, y = BIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_grey() +
theme(panel.grid.minor = element_blank())
single_cals <- read_csv("simulation_results/singles_011_results.csv")
cal_curve <- read_csv("intcal_20_interpolated.csv")
binned_sim_yrs <- single_cals %>%
mutate(bin_yrs <- ntile(target_year), 50) %>%
group_by(bin_yrs) %>%
summarize(
target_year = min(target_year),
bin_end = max(target_year)
)
binned_sim_yrs <- single_cals %>%
mutate(bin_yrs = ntile(target_year), 50) %>%
group_by(bin_yrs) %>%
summarize(
target_year = min(target_year),
bin_end = max(target_year)
)
binned_sim_yrs <- single_cals %>%
mutate(bin_yrs = ntile(target_year, 50)) %>%
group_by(bin_yrs) %>%
summarize(
target_year = min(target_year),
bin_end = max(target_year)
)
for (i in 1:nrow(binned_sim_yrs)) {
binned_sd <- cal_curve %>%
filter(CalBP >= binned_sim_yrs$target_year[i] &
CalBP <= binned_sim_yrs$bin_end[i])
}
View(binned_sd)
View(binned_sim_yrs)
binned_sim_yrs <- single_cals %>%
mutate(bin_yrs = ntile(target_year, 50)) %>%
group_by(bin_yrs) %>%
summarize(
bin_end = max(target_year),
target_year = min(target_year)
)
View(binned_sd)
View(binned_sim_yrs)
for (i in 1:nrow(binned_sim_yrs)) {
binned_sd <- cal_curve %>%
filter(CalBP >= binned_sim_yrs$target_year[i] &
CalBP <= binned_sim_yrs$bin_end[i])
}
View(binned_sd)
for (i in 1:nrow(binned_sim_yrs)) {
binned_sd <- cal_curve %>%
filter(CalBP >= binned_sim_yrs$target_year[i] &
CalBP <= binned_sim_yrs$bin_end[i]) %>%
summarize(bp_sd = sd(BP))
}
View(binned_sd)
for (i in 1:nrow(binned_sim_yrs)) {
binned_sd <- cal_curve %>%
filter(CalBP >= binned_sim_yrs$target_year[i] &
CalBP <= binned_sim_yrs$bin_end[i]) %>%
summarize(bp_sd = sd(BP)) %>%
pull(bp_sd)
}
## Now loop through each bin, and get BP sd for that group of years - a proxy for how variable the cal curve was (less = more plateau)
bp_sd <- c()
for (i in 1:nrow(binned_sim_yrs)) {
binned_sd <- cal_curve %>%
filter(CalBP >= binned_sim_yrs$target_year[i] &
CalBP <= binned_sim_yrs$bin_end[i]) %>%
summarize(bin_sd = sd(BP)) %>%
pull(bin_sd)
bp_sd <- c(bp_sd, binned_sd)
}
binned_sim_yrs <- rbind(binned_sim_yrs, bp_sd) %>%
select(target_year, bp_sd)
View(binned_sim_yrs)
binned_sim_yrs <- rbind(binned_sim_yrs, bp_sd)
View(binned_sim_yrs)
## Now loop through each bin, and get BP sd for that group of years - a proxy for how variable the cal curve was (less = more plateau)
bp_sd <- c()
binned_sim_yrs <- single_cals %>%
mutate(bin_yrs = ntile(target_year, 50)) %>%
group_by(bin_yrs) %>%
summarize(
bin_end = max(target_year),
target_year = min(target_year)
)
## Now loop through each bin, and get BP sd for that group of years - a proxy for how variable the cal curve was (less = more plateau)
bp_sd <- c()
for (i in 1:nrow(binned_sim_yrs)) {
binned_sd <- cal_curve %>%
filter(CalBP >= binned_sim_yrs$target_year[i] &
CalBP <= binned_sim_yrs$bin_end[i]) %>%
summarize(bin_sd = sd(BP)) %>%
pull(bin_sd)
bp_sd <- c(bp_sd, binned_sd)
}
binned_sim_yrs <- rbind(binned_sim_yrs, bp_sd)
binned_sim_yrs <- single_cals %>%
mutate(bin_yrs = ntile(target_year, 50)) %>%
group_by(bin_yrs) %>%
summarize(
bin_end = max(target_year),
target_year = min(target_year)
)
## Now loop through each bin, and get BP sd for that group of years - a proxy for how variable the cal curve was (less = more plateau)
bp_sd <- c()
for (i in 1:nrow(binned_sim_yrs)) {
binned_sd <- cal_curve %>%
filter(CalBP >= binned_sim_yrs$target_year[i] &
CalBP <= binned_sim_yrs$bin_end[i]) %>%
summarize(bin_sd = sd(BP)) %>%
pull(bin_sd)
bp_sd <- c(bp_sd, binned_sd)
}
binned_sim_yrs <- cbind(binned_sim_yrs, bp_sd) %>%
select(target_year, bp_sd)
View(binned_sim_yrs)
View(binned_sim_yrs)
inner_join(single_cals_log_diagnostics, binned_sim_yrs) %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = bp_sd, y = AIC)) +
geom_point(aes(colour = model)) +
facet_wrap(~model)
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_manual(values = c("grey10", "grey30", "grey50", "darkviolet")) +
theme(panel.grid.minor = element_blank())
## Lets make some plots
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_manual(values = c("grey10", "grey30", "grey50", "darkviolet")) +
theme(panel.grid.minor = element_blank())
single_cals_log_diagnostics %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = target_year, y = BIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_manual(values = c("grey10", "grey30", "grey50", "darkviolet")) +
theme(panel.grid.minor = element_blank())
single_cals_log_diagnostics %>%
filter(str_detect(model, "95")) %>%
ggplot(aes(x = target_year, y = AIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw()+
scale_color_manual(values = c("grey10", "grey30", "grey50", "darkviolet")) +
theme(panel.grid.minor = element_blank())
single_cals_log_diagnostics %>%
filter(str_detect(model, "95")) %>%
ggplot(aes(x = target_year, y = BIC)) +
geom_line(aes(color = model)) +
facet_wrap(~offset_pos) +
theme_bw() +
scale_color_manual(values = c("grey10", "grey30", "grey50", "darkviolet")) +
theme(panel.grid.minor = element_blank())
inner_join(single_cals_log_diagnostics, binned_sim_yrs) %>%
filter(str_detect(model, "68")) %>%
ggplot(aes(x = bp_sd, y = AIC)) +
geom_point(aes(colour = model)) +
facet_wrap(~model) +
theme_bw() +
scale_color_manual(values = c("grey10", "grey30", "grey50", "darkviolet")) +
theme(panel.grid.minor = element_blank())
single_cals_log_results <- read_csv("model_results/single_cals_log_results.csv")
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_ribbon(aes(ymin = estime - std.error * 2,
ymax = estimate + std.error * 2,
color = term), alpha = 0.5)
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_ribbon(aes(ymin = estimate - std.error * 2,
ymax = estimate + std.error * 2,
color = term), alpha = 0.5)
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_ribbon(aes(ymin = estimate - std.error * 2,
ymax = estimate + std.error * 2,
fill = term), alpha = 0.5)
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_ribbon(aes(ymin = estimate - std.error * 2,
ymax = estimate + std.error * 2,
fill = term), alpha = 0.5, color = "grey20")
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_ribbon(aes(ymin = estimate - std.error * 2,
ymax = estimate + std.error * 2,
fill = term), alpha = 0.5, color = "grey75")
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_ribbon(aes(ymin = estimate - std.error * 2,
ymax = estimate + std.error * 2,
fill = term), alpha = 0.5, color = "grey75") +
geom_line() +
facet_grid(cols = vars(offset_pos), rows = vars(model), scales = "free") +
theme_bw() +
theme(panel.grid.minor = element_blank())
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_ribbon(aes(ymin = estimate - std.error * 2,
ymax = estimate + std.error * 2,
fill = term), alpha = 0.5, color = "grey75") +
facet_grid(cols = vars(offset_pos), rows = vars(model), scales = "free") +
theme_bw() +
theme(panel.grid.minor = element_blank())
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_ribbon(aes(ymin = estimate - std.error * 2,
ymax = estimate + std.error * 2,
fill = term), alpha = 0.5, color = "grey75") +
geom_line(col = "grey50", linetype = "dotted") +
facet_grid(cols = vars(offset_pos), rows = vars(model), scales = "free") +
theme_bw() +
theme(panel.grid.minor = element_blank())
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_ribbon(aes(ymin = estimate - std.error * 2,
ymax = estimate + std.error * 2,
fill = term), alpha = 0.5, color = "grey75") +
geom_line(aes(color = term), linetype = "dotted") +
facet_grid(cols = vars(offset_pos), rows = vars(model), scales = "free") +
theme_bw() +
theme(panel.grid.minor = element_blank())
single_cals_log_results %>%
filter(str_detect(model, "interact") & !str_detect(term, "Intercept")) %>%
ggplot(aes(x = target_year, y = estimate)) +
geom_ribbon(aes(ymin = estimate - std.error * 2,
ymax = estimate + std.error * 2,
fill = term), alpha = 0.2, color = "grey75") +
geom_line(aes(color = term), linetype = "dotted") +
facet_grid(cols = vars(offset_pos), rows = vars(model), scales = "free") +
theme_bw() +
theme(panel.grid.minor = element_blank())
